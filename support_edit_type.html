<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Support Type Editor</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <style>
    table {
      font-size: 0.85rem;
    }
    th, td {
      vertical-align: middle;
    }
  </style>
</head>
<body>
<nav class="navbar navbar-dark bg-dark navbar-expand-sm justify-content-center">
  <div class="container-fluid">
    <a class="navbar-brand" href="#"><img src="img/tokai.png" alt="Logo" style="height:40px; margin-right:10px;" />Umamusume Stat Guide Edit Tool</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#collapsibleNavbar">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="collapsibleNavbar">
      <ul class="navbar-nav">
        <li class="nav-item">
          <a class="nav-link" href="editjs.html">Add/Update Horsegirl</a>
        </li> 
        <li class="nav-item">
          <a class="nav-link active" href="support_edit_type.html">Update Support Type</a>
        </li>			
      </ul>
    </div>
  </div>
</nav>

  <div class="container">
    <h3 class="mb-4">Support Type Editor</h3>
    <div class="table-responsive">
      <table id="supportTable" class="table table-striped table-bordered table-sm align-middle">
        <thead class="table-light">
          <tr>
            <th>Support Name</th>
            <th>Type</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
    <button class="btn btn-primary mt-3" onclick="saveFile()">Save support_types.js</button>
  </div>

  <script src="horsegirls.js"></script>
  <script src="support_types.js"></script>
  <script>
    const typeOptions = ["", "Speed", "Stamina", "Power", "Guts", "Wit", "Pal"];

    // Get distinct supports from HORSEGIRLS
    const distinctSupports = new Set();
    for (const hg of Object.values(HORSEGIRLS)) {
      for (const sup of Object.values(hg.support)) {
        if (sup && sup.trim() !== "") {
          distinctSupports.add(sup.trim());
        }
      }
    }

    // Convert SUPPORT_CARDS into a lookup
    const supportLookup = {};
    for (const card of SUPPORT_CARDS) {
      if (card.name) {
        supportLookup[card.name] = card.type;
      }
    }

    const tbody = document.querySelector("#supportTable tbody");

    distinctSupports.forEach(support => {
      const tr = document.createElement("tr");

      const tdName = document.createElement("td");
      tdName.innerHTML = "<b>" + support + "</b>";

      const tdType = document.createElement("td");
      const select = document.createElement("select");
      select.classList.add("form-select", "form-select-sm");

      typeOptions.forEach(opt => {
        const option = document.createElement("option");
        option.value = opt;
        option.textContent = opt;
        if (supportLookup[support] === opt) {
          option.selected = true;
        }
        select.appendChild(option);
      });

      tdType.appendChild(select);
      tr.appendChild(tdName);
      tr.appendChild(tdType);
      tbody.appendChild(tr);
    });

    function saveFile() {
      const rows = tbody.querySelectorAll("tr");
      const newCards = [];

      rows.forEach(row => {
        const name = row.querySelector("td b").innerText;
        const type = row.querySelector("select").value;
        newCards.push({ name, type });
      });

      const fileContent = "const SUPPORT_CARDS = " + JSON.stringify(newCards, null, 2) + ";";
      const blob = new Blob([fileContent], { type: "application/javascript" });
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = "support_types.js";
      link.click();
    }
  </script>
</body>
</html>
